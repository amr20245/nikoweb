<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Deposit Form (Backend)</title>
  <style>
:root{--radius:12px;--shadow:0 10px 30px rgba(0,0,0,.08)}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#f7f7fb;line-height:1.4}
header{padding:24px 20px;text-align:center;background:linear-gradient(135deg,#111,#333);color:#fff}
header h1{margin:0 0 6px;font-size:22px;letter-spacing:.3px}
header p{margin:0;opacity:.8;font-size:13px}
.wrap{max-width:760px;margin:24px auto;padding:0 16px}
.card{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:20px}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}
.row{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
label{display:block;font-weight:600;font-size:13px;margin-bottom:6px}
input,select,textarea{width:100%;padding:12px 12px;border:1px solid #ddd;border-radius:10px;font-size:15px;outline:none;transition:border-color .2s ease;background:#fff}
input:focus,select:focus,textarea:focus{border-color:#222}
.muted{color:#666;font-size:13px}
.summary{background:#fafafa;border:1px dashed #ddd;border-radius:10px;padding:12px;font-size:14px}
.btn{appearance:none;border:0;border-radius:999px;padding:12px 18px;font-weight:700;box-shadow:var(--shadow);cursor:pointer;background:#111;color:#fff}
.btn.light{background:#f0f0f0;color:#111}
.btn:disabled{opacity:.6;cursor:not-allowed}
.right{margin-left:auto}
.status{margin-top:10px;font-size:14px}
.ok{color:#0a7a25}.err{color:#a11212}
@media(max-width:720px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<header>
  <h1>Deposit Form</h1>
  <p>Elite Furniture — 1834 E. Seymour Ave., Cincinnati, OH 45237 — 513-429-5011</p>
</header>
<div class="wrap">
  <div class="card">
    <div class="grid">
      <div>
        <label for="employee">Employee</label>
        <input id="employee" placeholder="Your name" autocomplete="name" />
      </div>
      <div>
        <label for="method">Payment Method</label>
        <select id="method">
          <option>Cash</option><option>Card</option><option>Cash + Card</option><option>Other</option>
        </select>
      </div>
      <div>
        <label for="register">Register/Batch</label>
        <input id="register" placeholder="e.g., Main Drawer" />
      </div>
      <div>
        <label for="total_due">Total Due ($)</label>
        <input id="total_due" type="number" step="0.01" min="0" placeholder="1170.00" />
      </div>
      <div>
        <label for="amount_paid">Customer Paid ($)</label>
        <input id="amount_paid" type="number" step="0.01" min="0" placeholder="1180.00" />
      </div>
    </div>
    <div class="row"><div class="summary" style="flex:1">
      <div id="calc_summary">Change Due: —</div>
      <div class="muted" id="calc_hint">Enter amounts to see change. Example: Paid $1180 on $1170 → Change $10.</div>
    </div></div>
    <div class="row"><textarea id="notes" rows="2" placeholder="Notes (optional)" style="flex:1"></textarea></div>
    <div class="row">
      <button class="btn" id="save_btn" onclick="saveDeposit()">Save to Server</button>
      <button class="btn light right" onclick="printSlip()">Print Deposit Slip</button>
    </div>
    <div class="status" id="status"></div>
  </div>
</div>
<script>
  // === Configuration ===
  const USE_BACKEND = true;          // backend-enabled
  const API_TOKEN   = 'CHANGE_ME';   // set this to match backend .env API_TOKEN
  const API_BASE    = '';            // same origin (leave empty) or e.g. 'https://example.com'

  function parseMoneyToCents(val){const cleaned=String(val??'').replace(/[$,]/g,'').trim();if(cleaned==='')return 0;const num=Number(cleaned);return Number.isNaN(num)?0:Math.round(num*100)}
  function centsToMoney(c){const n=(c/100);return n.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}
  function updateSummary(){const due=parseMoneyToCents(total_due.value);const paid=parseMoneyToCents(amount_paid.value);const diff=paid-due;if(due===0&&paid===0){calc_summary.textContent='Change Due: —';calc_hint.textContent='Enter amounts to see change. Example: Paid $1180 on $1170 → Change $10.';return}if(diff>=0){calc_summary.textContent='Change Due: $'+centsToMoney(diff);calc_hint.textContent='Paid in full. Return this change to the customer.'}else{calc_summary.textContent='Amount Remaining: $'+centsToMoney(-diff);calc_hint.textContent='Customer still owes this amount.'}}
  ['total_due','amount_paid'].forEach(id=>document.getElementById(id).addEventListener('input',updateSummary));
  function payload(){return{employee:employee.value.trim(),method:method.value,register:register.value.trim(),total_due:total_due.value,amount_paid:amount_paid.value,notes:notes.value.trim()};}

  async function saveDeposit(){
    status.textContent='';
    const data = payload();
    if(!data.total_due || !data.amount_paid){ status.innerHTML='<span class="err">Enter both Total Due and Customer Paid.</span>'; return; }
    if(!USE_BACKEND){ status.innerHTML='<span class="err">Backend disabled.</span>'; return; }
    try{
      const res = await fetch((API_BASE||'') + '/api/deposits', {
        method: 'POST',
        headers: {'Content-Type':'application/json','X-API-KEY': API_TOKEN},
        body: JSON.stringify(data)
      });
      const json = await res.json();
      if(json.ok){
        status.innerHTML = '<span class="ok">Saved. Deposit ID: '+json.deposit_id+' | Change: $'+json.change_given+(Number(json.amount_remaining)>0 ? ' | Remaining: $'+json.amount_remaining : '')+'</span>';
      }else{
        status.innerHTML = '<span class="err">Error: '+(json.error||'Unknown')+'</span>';
      }
    }catch(err){
      status.innerHTML = '<span class="err">Network error: '+err+'</span>';
    }
  }

  function printSlip(){const now=new Date();const pad=n=>String(n).padStart(2,'0');const dateStr=now.getFullYear()+'-'+pad(now.getMonth()+1)+'-'+pad(now.getDate());const timeStr=pad(now.getHours())+':'+pad(now.getMinutes());const due=Number(total_due.value||0).toFixed(2);const paid=Number(amount_paid.value||0).toFixed(2);const diff=(Number(paid)-Number(due));const change=(diff>=0?diff:0).toFixed(2);const html=`<html><head><meta charset="utf-8" /><title>Deposit Slip</title><style>body{{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:24px}}.slip{{width:380px;padding:16px;border:1px solid #000}}h2{{margin:0 0 8px;font-size:16px;text-align:center}}.row{{display:flex;gap:8px;margin-bottom:6px}}.label{{width:160px;font-weight:600}}@media print{{.noprint{{display:none}}}}</style></head><body><div class="slip"><h2>Elite Furniture — Deposit Slip</h2><div style="text-align:center;font-size:11px;margin-bottom:8px">1834 E. Seymour Ave., Cincinnati, OH 45237 • 513-429-5011</div><div class="row"><div class="label">Date:</div><div>${{dateStr}}</div></div><div class="row"><div class="label">Time:</div><div>${{timeStr}}</div></div><div class="row"><div class="label">Employee:</div><div>${{employee.value||''}}</div></div><div class="row"><div class="label">Amount Put In Drawer ($):</div><div>${{paid}}</div></div><div class="row"><div class="label">Total Due ($):</div><div>${{due}}</div></div><div class="row"><div class="label">Change Returned ($):</div><div>${{change}}</div></div><div class="row"><div class="label">Drawer / Batch #:</div><div>${{register.value||'__________'}}</div></div><div class="row"><div class="label">Signature:</div><div>______________________________</div></div></div><p class="noprint"><button onclick="window.print()">Print</button></p></body></html>`;const w=window.open('','slip','width=420,height=600');w.document.write(html);w.document.close();w.focus();setTimeout(()=>{{w.print();w.close();}},200)}
</script>
</body>
</html>
